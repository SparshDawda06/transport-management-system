{% extends 'base.html' %}
{% block title %}Order Details - TMS{% endblock %}
{% block content %}
<div class="detail-container">
  <div class="detail-header">
    <div>
      <h1 class="detail-title">Order #{{ order.id }}</h1>
      <p class="text-sm text-secondary">{{ order.date.strftime('%B %d, %Y') }}</p>
    </div>
    <div class="detail-actions">
      <a href="{{ url_for('orders.edit_order', order_id=order.id) }}" class="btn btn-primary">Edit</a>
      <button onclick="deleteOrder({{ order.id }})" class="btn btn-secondary">Delete</button>
      <a href="{{ url_for('orders.list_orders') }}" class="btn btn-secondary">Back to List</a>
    </div>
  </div>
  
  <div class="detail-content">
    <!-- Basic Information -->
    <div class="detail-section">
      <h2 class="detail-section-title">Basic Information</h2>
      <div class="detail-grid">
        <div class="detail-label">Order ID</div>
        <div class="detail-value">{{ order.id }}</div>
      </div>
      <div class="detail-grid">
        <div class="detail-label">Date</div>
        <div class="detail-value">{{ order.date.strftime('%B %d, %Y') }}</div>
      </div>
      <div class="detail-grid">
        <div class="detail-label">Firm</div>
        <div class="detail-value">{{ order.firm or 'Not specified' }}</div>
      </div>
      <div class="detail-grid">
        <div class="detail-label">Order Type</div>
        <div class="detail-value">
          <span class="status-badge {{ 'status-active' if order.order_type == 'PARTY' else 'status-on-sale' }}">
            {{ order.order_type }}
          </span>
        </div>
      </div>
      <div class="detail-grid">
        <div class="detail-label">Status</div>
        <div class="detail-value">
          <span class="status-badge {{ 'status-active' if order.status == 'confirmed' else 'status-pending' if order.status == 'dispatched' else 'status-inactive' }}">
            {{ order.status.title() }}
          </span>
        </div>
      </div>
    </div>

    <!-- Route Information -->
    <div class="detail-section">
      <h2 class="detail-section-title">Route Information</h2>
      <div class="detail-grid">
        <div class="detail-label">From Station</div>
        <div class="detail-value">{{ order.from_station.name if order.from_station else 'Not specified' }}</div>
      </div>
      <div class="detail-grid">
        <div class="detail-label">To Station</div>
        <div class="detail-value">{{ order.to_station.name if order.to_station else 'Not specified' }}</div>
      </div>
    </div>

    <!-- Party Information -->
    {% if order.order_type == 'PARTY' %}
    <div class="detail-section">
      <h2 class="detail-section-title">Party Information</h2>
      <div class="detail-grid">
        <div class="detail-label">Consignor</div>
        <div class="detail-value">{{ order.consignor.name if order.consignor else 'Not specified' }}</div>
      </div>
      <div class="detail-grid">
        <div class="detail-label">Consignee</div>
        <div class="detail-value">{{ order.consignee.name if order.consignee else 'Not specified' }}</div>
      </div>
    </div>
    {% else %}
    <div class="detail-section">
      <h2 class="detail-section-title">Agent Information</h2>
      <div class="detail-grid">
        <div class="detail-label">Booking Agent</div>
        <div class="detail-value">{{ order.booking_agent.name if order.booking_agent else 'Not specified' }}</div>
      </div>
    </div>
    {% endif %}

    <!-- Goods Information -->
    <div class="detail-section">
      <h2 class="detail-section-title">Goods Information</h2>
      <div class="detail-grid">
        <div class="detail-label">Goods</div>
        <div class="detail-value">{{ order.goods.description if order.goods else 'Not specified' }}</div>
      </div>
      <div class="detail-grid">
        <div class="detail-label">Weight</div>
        <div class="detail-value">{{ order.weight or 'Not specified' }} kg</div>
      </div>
      <div class="detail-grid">
        <div class="detail-label">Rate</div>
        <div class="detail-value">₹{{ order.rate or 'Not specified' }}</div>
      </div>
    </div>

    <!-- Financial Information -->
    <div class="detail-section">
      <h2 class="detail-section-title">Financial Information</h2>
      <div class="detail-grid">
        <div class="detail-label">Total Amount</div>
        <div class="detail-value">₹{{ (order.weight * order.rate) if order.weight and order.rate else 'Not calculated' }}</div>
      </div>
      {% if order.order_type == 'AGENT' %}
      <div class="detail-grid">
        <div class="detail-label">Agent Commission</div>
        <div class="detail-value">{{ order.agent_commission or 'Not specified' }}%</div>
      </div>
      {% endif %}
    </div>
  </div>
</div>

<script>
function deleteOrder(orderId) {
  if (confirm('Are you sure you want to delete this order?')) {
    fetch(`/orders/${orderId}`, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        window.location.href = '/orders';
      } else {
        alert('Error deleting order');
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('Error deleting order');
    });
  }
}
</script>
{% endblock %}